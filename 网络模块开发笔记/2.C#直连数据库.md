## C#直连数据库

导入MySql配置文件 MySql.Data.dll文件 目录为:

```
C:\Program Files (x86)\MySQL\Connector NET 8.0\Assemblies\v4.5.2\MySql.Data.dll
```

版本尽量与C#版本相同,项目属性可以找到.net框架版本

![image-20210902092101866](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210902092101866.png)

```csharp
using System;
using MySql.Data.MySqlClient;

namespace CSharp直接连接Sql
{
    class Program
    {
        /// <summary>
        /// 连接数据库的ip地址等...
        /// </summary>
        static string connectStr = "server=127.0.0.1;port=3306;database=mygamedb;user=root;password=root;";
        static void Main( string[] args )
        {
            //Insert ();
            //Update ();
            //Delete ();
            //ReadUsersCount ();
            //ExcuteScalar ();
            Read ();
            //Console.WriteLine (VerifyUser ("Chai", "123"));
           
            Console.ReadKey ();
        }
        /// <summary>
        /// 登录
        /// </summary>
        /// <param name="username"></param>
        /// <param name="password"></param>
        /// <returns></returns>
        static bool VerifyUser( string username, string password )
        {
            MySqlConnection conn = new MySqlConnection (connectStr);//并没有建立连接,进行初始化
            try
            {
                conn.Open ();//建立连接
                string sql = "";
                //sql = "select * from users where username='"+ username + "' and password='"+password+"'";//普通验证
                sql = "select * from users where username= @paral1 and password=@paral2";//高级验证 字符替换
                MySqlCommand cmd = new MySqlCommand (sql, conn);
                cmd.Parameters.AddWithValue ("paral1", username); 
                cmd.Parameters.AddWithValue ("paral2", password);
                MySqlDataReader reader = cmd.ExecuteReader ();
                return reader.Read ();//返回是否读取到数据
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
            return false;
        }

        /// <summary>
        /// 查询
        /// </summary>
        static  void Reads()
        {
            MySqlConnection conn = new MySqlConnection (connectStr);//并没有建立连接,进行初始化
            try
            {
                conn.Open ();//建立连接
                string sql = "";
                //sql = "select id,username,registerdate from users";//指定查询
                sql = "select * from users";//全部查询
                MySqlCommand cmd = new MySqlCommand (sql, conn);
                //cmd.ExecuteReader ();//查询时使用
                //cmd.ExecuteNonQuery ();//增删改时使用
                //cmd.ExecuteScalar ();//执行一些查询,返回一个单个的值
                MySqlDataReader reader = cmd.ExecuteReader ();
                while (reader.Read ())
                {
                    string str = "|\t";
                    for (int i = 0; i < reader.FieldCount; i++)
                    {
                        str += reader[i] + "\t |\t";
                    }
                    Console.WriteLine (" ________________________________________________________________________________________________");
                    Console.WriteLine (str);
                    Console.WriteLine (" ￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣￣");
                }
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
        }
        /// <summary>
        /// 增加
        /// </summary>
        static void Insert()
        {
            MySqlConnection conn = new MySqlConnection (connectStr);
            try
            {
                conn.Open ();//建立连接
                string sql = "";
                sql = "insert into users(username,password,registerdate) values('Newusername2','Newpassword2','"+ DateTime.Now + "')";//插入一条数据
                MySqlCommand cmd = new MySqlCommand (sql, conn);
                int result = cmd.ExecuteNonQuery ();//返回受影响的数据行数
                Console.WriteLine (result);
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
        }
        /// <summary>
        /// 修改
        /// </summary>
        static void Update()
        {
            MySqlConnection conn = new MySqlConnection (connectStr);
            try
            {
                conn.Open ();//建立连接
                string sql = "";
                sql = "update users set password ='pass17' where id=16;";//修改一条数据
                MySqlCommand cmd = new MySqlCommand (sql, conn);
                int result = cmd.ExecuteNonQuery ();//返回受影响的数据行数
                Console.WriteLine (result);
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
        }
        /// <summary>
        /// 删除
        /// </summary>
        static void Delete()
        {
            //连接数据库的ip地址等...
            MySqlConnection conn = new MySqlConnection (connectStr);//并没有建立连接
            try
            {
                conn.Open ();//建立连接
                string sql = "";
                sql = "delete from users where id='15'";//删除一条数据
                MySqlCommand cmd = new MySqlCommand (sql, conn);
                int result = cmd.ExecuteNonQuery ();//返回受影响的数据行数
                Console.WriteLine (result);
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
        }
        /// <summary>
        /// 获取Count1
        /// </summary>
        static void ReadUsersCount()
        {
            MySqlConnection conn = new MySqlConnection (connectStr);//并没有建立连接,进行初始化
            try
            {
                conn.Open ();//建立连接
                string sql = "";
                sql = "select count(*) from users";//全部查询
                MySqlCommand cmd = new MySqlCommand (sql, conn);
                MySqlDataReader reader = cmd.ExecuteReader ();
                reader.Read ();
                int count = Convert.ToInt32 (reader[0].ToString());
                Console.WriteLine (count);
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
        }
        /// <summary>
        /// 获取Count2
        /// </summary>
        static void ExcuteScalar()
        {
            MySqlConnection conn = new MySqlConnection (connectStr);//并没有建立连接,进行初始化
            try
            {
                conn.Open ();//建立连接
                string sql = "";
                sql = "select count(*) from users";//全部查询
                MySqlCommand cmd = new MySqlCommand (sql, conn);
                
                Console.WriteLine (cmd.ExecuteScalar ());
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
        }
        /// <summary>
        /// 读取指定数据
        /// </summary>
        static void Read()
        {
            MySqlConnection conn = new MySqlConnection (connectStr);//并没有建立连接,进行初始化
            try
            {
                conn.Open ();//建立连接
                string sql = "";

                sql = "select * from users";//全部查询
                MySqlCommand cmd = new MySqlCommand (sql, conn);

                MySqlDataReader reader = cmd.ExecuteReader ();
                while (reader.Read ())
                {
                    //Console.WriteLine (reader.GetInt32 (0) + " " + reader.GetString (1) + " " + reader.GetString (2));
                    Console.WriteLine (reader .GetInt32("id")+ " "+reader.GetString("username")+" "+ reader.GetString("password"));
                }
            }
            catch (Exception e)
            {
                Console.WriteLine (e.ToString ());
            }
            finally//无论如何都会执行
            {
                conn.Close ();//关闭连接
            }
        }
    }
}

```

