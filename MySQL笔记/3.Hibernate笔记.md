## Hibernate笔记

#### 配置:

- 新建一个控制台项目(测试连接数据库)

- 添加NHibernate 引用 与 MySqlData引用(NHibernate 官网下载 dll文件目录:NHibernate\Required_Bins\NHibernate.dll)

- 在这个项目属性把程序集名称与默认命名空间修改一下,待会配置时需要用到. 	程序集代表bin\debug\.exe文件

- 映射文件配置:根目录项目下添加新建项XML 名字:hibernate.cfg.xml 名字固定的

  内容参考文档**Configure NHibernate**内容:

  [文档链接](https://nhibernate.info/doc/tutorials/first-nh-app/your-first-nhibernate-based-application.html )
  
  ```xml
  <?xml version="1.0" encoding="utf-8" ?>
  <hibernate-configuration xmlns="urn:nhibernate-configuration-2.2">
    <session-factory>
      <property name="connection.provider">NHibernate.Connection.DriverConnectionProvider</property>
      <property name="dialect">NHibernate.Dialect.MySQL5Dialect</property>  
        //这里设置MySql版本,我用的MySql8.0,写成5也是可以的,不是很明白
      <property name="connection.driver_class">NHibernate.Driver.MySqlDataDriver</property> 
        //设置连接的数据库,使用什么数据库 MySqlDataDriver MySql大小写不能写错
      <property name="connection.connection_string">Server=localhost;Database=mygamedb;User ID=root; Password=root;</property>
        //配置连接设置,语句后加分号
  
      <property name="show_sql">true</property>
        //控制台显示Sql语句
    </session-factory>
  </hibernate-configuration>
  ```
  
  配置文件设置:复制到输出目录:始终复制
  
  ![image-20210902090916894](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210902090916894.png)
  
- 创建模型类 在根目录创建model文件,在这个文件了添加类,类名与属性一定要与表名对应起来,不容易出错,例如:

```csharp
    public class User
    {
        public virtual int Id { get; set; }
        public virtual string Username { get; set; }
        public virtual string Password { get; set; }
        public virtual DateTime Registerdate { get; set; }

    }
```

![image-20210902084424642](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210902084424642.png)

- 添加映射文件,一个类对应一个映射文件,根目录添加Mappings,Mappings文件下创建XML配置文件,名称保持规范User.hbm.xml

  内容参考文档**The complete mapping file**内容:

  [文档链接](https://nhibernate.info/doc/tutorials/first-nh-app/your-first-nhibernate-based-application.html )

  ```xml
  <?xml version="1.0" encoding="utf-8" ?>
  //版本
  <hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"
                     //版本
                     assembly="NHibernateTangZe"
                     //程序集名
                     namespace="NHibernateTangZe.Model">
      			  //命名空间
  //映射:
    <class name="User" table="users">
        //类对应表
      <id name="Id" column="id" type="Int32">
          //字段对应列名,类型
        <generator class="native" />
          设置生成器:类型为:本地,本地为自动增长
      </id>
      <property name="Username" column="username" type="String"></property>
        //字段对应列名 type类型为Hibernate类型
      <property name="Password" column="password" type="String"></property>
      <property name="Registerdate" column="registerdate" type="Date" ></property>
    </class>
  </hibernate-mapping>
  ```

  类型参考链接:

  [文档连接](https://nhibernate.info/doc/nhibernate-reference/mapping.html#mapping-types)

  配置命名空间下的这个类与数据库的某个数据相对应,从而进行映射

  配置文件设置:生成操作:嵌入的资源(需要与程序集打包到一起)

  ![image-20210902091108642](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210902091108642.png)

- 

